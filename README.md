### Документация: Автоматизированное развертывание инфраструктуры TeamCity и Nexus в Яндекс.Облаке с помощью Terraform

#### Краткое описание

Проект предназначен для **автоматического создания инфраструктуры** (сетей, подсетей, групп безопасности, виртуальных машин) в Яндекс.Облаке, необходимых для развёртывания CI/CD сервера TeamCity (сервер + агент), а также репозитория артефактов Nexus. Все ресурсы создаются с помощью Terraform модулей, использующих Terraform Provider для Яндекс.Облака.

#### Основные компоненты:

- **Сеть и группы безопасности:**  
  Модуль `yandex-vpc` создаёт виртуальную сеть, подсеть и группу безопасности с необходимыми правилами (входящий трафик на 80, 443, 22, 8111, 8081 порты и полный исходящий трафик).

- **Виртуальные машины:**  
  Используются отдельные модули для быстрой и удобной генерации VM для:
  - TeamCity Server (порт 8111)
  - TeamCity Agent
  - Nexus Repository (порт 8081)
  Каждая VM разворачивается из последней версии Ubuntu, подключается к созданной сети, получает SSH-ключ, дополнительные метаданные для инициализации и необходимые теги/ярлыки.

- **Инициализация VM:**  
  Поддерживаются облачные init-скрипты для автоматической настройки ПО через Cloud-Init: настройки для каждого типа VM хранятся в отдельных yaml-файлах (`teamcity-server-init.yml`, `teamcity-agent-init.yml`, `nexus-vm-init.yml`).

- **Взаимодействие компонентов:**  
  Все ресурсы создаются с правильной зависимостью друг от друга:  
  - Сначала сеть и группа безопасности  
  - Затем TeamCity Server  
  - После него TeamCity Agent  
  - В конце Nexus VM  
  При этом VM agent получает ссылку на TeamCity Server для автоматической регистрации.

#### Требования

- Аккаунт в Яндекс.Облаке с доступом к соответствующим ресурсам.
- Предварительно подготовленные init-файлы для cloud-init.
- SSH-ключ для root пользователя.
- Terraform >= 1.0.x

#### Сценарии использования

1. Форкните репозиторий.
2. Определите значения переменных (например, SSH ключ, семейство образа Ubuntu, имена, количество инстансов и пр.).
3. Запустите terraform init, затем terraform apply для автоматического развёртывания всей структуры — через пару минут все сервисы будут запущены и готовы к работе.

#### Предназначено для

- Автоматизации создания платформы CI/CD с TeamCity + Nexus для небольших и средних команд разработки.
- Быстрого деплоя окружения для экспериментов, тестирования, учебных целей.

***

**P.S.** Подробную информацию по структуре модулей, переменным и полезным сценариям развёртывания смотрите в README и примерах внутри репозитория.

<details>
  <summary>Полезные команды</summary>
  
`cd /mnt/c/Users/rlyst/Netology/09-ci-05-teamcity/terraform`

`docker run -d -e SERVER_URL="http://89.169.159.107:8111" jetbrains/teamcity-agent`

`ansible-playbook -i /mnt/c/Users/rlyst/Netology/09-ci-05-teamcity/infrastructure/inventory/cicd/hosts.yml /mnt/c/Users/rlyst/Netology/09-ci-05-teamcity/infrastructure/site.yml --ssh-extra-args='-o StrictHostKeyChecking=no'`

</details>
